---
title: FailOver数据库切换方案
tags: 数据库,切换,FailOver
grammar_cjkRuby: true
---


### 设计目的

为防止系统因数据库出现问题导致整体服务不可用，能够快速进行数据库切换，做到秒级数据库切换，能够将数据库硬件软件等故障的风险降到最低。
	
### 设计思路

1. 将failOver数据源通过disconf分发给不同的业务系统
2. 通过failOver数据源配置将数据源配置进数据源中
3. 通过调整数据源的是否在failOver状态进行切库
4. 进行数据库恢复，成功后在通过api切回正常的库

### 方案优缺点

#### 优点：
1. 只需要disconf管理failOver数据库配置文件或者放在项目配置文件中即可
2. 通过更改数据源切换jar包，不需要对现有代码进行任何更改可以进行基本的数据库切换。
#### 缺点
1. 需要更改项目中的配置文件。

### 关联问题解决方案
1. 数据同步问题
>可以对failOver库进行实时数据同步，来尽量减少数据库的同步问题以及数据不一致问题

2. oracle 序列自增问题问题
>如果是生成的订单问题，可以通过改变订单的某一位或者加一个数据库编号，或者分布式序列生成来规避订单号冲突问题，如果是使用的是数据库序列就需要使用分布式ID生成方案了，需要对代码层面进行更改

#### 更改方案
1.	使用分布式id生成器（改动较大）
2.	使用序列+数据库编码（改动较小）
3. 分库事物问题
	暂时没有好的解决方案。
4. 数据最终一致性
	通过同步数据，数据库后，将数据导入到主库中。

